<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Галерея</title>

<script src="https://unpkg.com/fflate@0.8.2/umd/index.js"></script>

<style>
body {
  margin: 0;
  padding: 1cm;
  font-family: system-ui, sans-serif;
  background: #fff;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1cm;
}

button {
  padding: 0.6em 1.2em;
  font-size: 1rem;
  cursor: pointer;
}

.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 0.25cm;
}

.gallery img {
  width: 100%;
  height: auto;
  background: #f2f2f2;
}

#modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#modalContent {
  background: white;
  padding: 1.2cm;
  width: 300px;
  text-align: center;
  border-radius: 6px;
}

progress {
  width: 100%;
  height: 18px;
}
</style>
</head>

<body>

<header>
  <h1>Галерея</h1>
  <button onclick="skachatZip()">Скачать всё ZIP</button>
</header>

<div class="gallery" id="galleryContainer">
  </div>

<div id="modal">
  <div id="modalContent">
    <p id="status">Подготовка...</p>
    <progress id="progress" value="0" max="100"></progress>
  </div>
</div>

<script>
// Генерируем список файлов автоматически, вместо ручного перечисления с ошибками
const spisokFailov = [];
const bazoviyUrl = 'https://raw.githubusercontent.com/Artyomka628/artyom-bday/refs/heads/main/';
const containerGalerei = document.getElementById('galleryContainer');

for (let i = 1; i <= 82; i++) {
    const imyaFaila = `${i}.png`;
    
    // Добавляем в данные для скачивания
    spisokFailov.push({
        name: imyaFaila,
        url: bazoviyUrl + imyaFaila
    });

    // Отрисовываем картинку на странице
    const img = document.createElement('img');
    img.src = bazoviyUrl + imyaFaila;
    img.loading = "lazy";
    containerGalerei.appendChild(img);
}

// Элементы UI
const modal = document.getElementById("modal");
const progress = document.getElementById("progress");
const statusText = document.getElementById("status");

async function skachatZip() {
  try {
      modal.style.display = "flex";
      progress.value = 0;
      statusText.textContent = "Загрузка файлов...";

      // Даём браузеру время перерисовать модальное окно
      await new Promise(r => requestAnimationFrame(r));

      const dannyeDlyaZip = {};
      let zagruzheno = 0;

      // Скачиваем все файлы параллельно
      await Promise.all(spisokFailov.map(async (fail) => {
        const otvet = await fetch(fail.url);
        if (!otvet.ok) throw new Error(`Ошибка загрузки ${fail.name}`);
        
        const buffer = new Uint8Array(await otvet.arrayBuffer());
        dannyeDlyaZip[fail.name] = buffer;

        zagruzheno++;
        // Обновляем прогресс (до 70% на этап скачивания)
        progress.value = Math.round((zagruzheno / spisokFailov.length) * 70);
      }));

      statusText.textContent = "Упаковка архива...";
      await new Promise(r => setTimeout(r, 100)); // Небольшая пауза для UI

      // Создаем ZIP (синхронно)
      const zipArhiv = fflate.zipSync(dannyeDlyaZip, { level: 6 });
      progress.value = 90;

      // Создаем ссылку и скачиваем
      const blob = new Blob([zipArhiv], { type: "application/zip" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "images.zip";
      a.click();

      URL.revokeObjectURL(url);

      progress.value = 100;
      statusText.textContent = "Готово!";

      setTimeout(() => {
        modal.style.display = "none";
      }, 1500);

  } catch (error) {
      console.error(error);
      statusText.textContent = "Ошибка!";
      alert("Произошла ошибка при скачивании. Проверьте консоль.");
      setTimeout(() => { modal.style.display = "none"; }, 2000);
  }
}
</script>

</body>
</html>
